# {metæffekt} Inventory Overview Report

## Introduction

As compared to the detailed view provided by the [VAD](../../metaeffekt-vulnerability-assessment-dashboard/README.md), {metæffekt} tooling also enables the displaying of a more general view across multiple assets.
The **Inventory Overview Report** informs users on their vulnerability assessment situation across multiple inventories.
This allows not only the comparing of vulnerability assessments across multiple assets, but also of multiple assessments performed on the same asset, forming multiple **Assessment Context**s (Also called Audiences). 
A multitude of filtering options also deliver the ability to display only a selected set of vulnerability information and answer fairly specific vulnerability posture questions. 

![inventory-overview.png](inventory-overview.png)

## Configuring Notifications

In order to notify relevant parties of relevant vulnerabilities the generation process of the **Inventory Overview Report** also allows specifying emails and groups with rules of when to notify them.
These rules define a trigger condition and a content body, while the notifications use these rules to activate themselves and specify affected parties (via email or more general grouping descriptor).
When the configured threshold of vulnerabilities in the configured severity, in a specific **Assessment Context**, etc. a JSON notification file is generated, which may be consumed by further processes.

How the resulting notifications are generated is highly customizable.

### Notification

A `notification` consists of:

- a unique identifiable name
- `rules`: a list of [rules](#rules) which, when all evaluate to true, triggers the generation of the notification
- `audience`: a comma-seperated list of the considered **Assessment Context** 
- `groups`/`emails`: a list of descriptors of the to-be-notified parties (such as the direct email addresses or a more general grouping)

<details>
<summary>Click to show the full json schema</summary>

```json
{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://www.metaeffekt.com/schema/artifact-analysis/latest/overview-notification.json",
  "title": "Notification configuration for Inventory Overview Report",
  "description": "A single or multiple rules for the automatic alerting of 'audiences' in the Inventory Overview Report",
  "type": "object",
  "patternProperties": {
    ".*": {
      "type": "object",
      "properties": {
        "audience": {
          "type": "string"
        },
        "rules": {
          "$ref": "#/$defs/minLengthArray"
        },
        "emails":  {
          "$ref": "#/$defs/minLengthArray"
        },
        "groups":  {
          "$ref": "#/$defs/minLengthArray"
        },
        "merge vulnerabilities": {
          "type": "string",
          "enum": [
            "none",
            "most severe status"
          ]
        }
      },
      "required": [
        "rules"
      ],
      "anyOf": [
        {
          "required": [
            "emails"
          ]
        },
        {
          "required": [
            "groups"
          ]
        }
      ],
      "additionalProperties": false
    }
  },
  "$defs": {
    "minLengthArray": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minLength": 1
    }
  }
}
```
</details>

Example:

```yaml
Config-02:
  audience: Audience-A, Audience-B
  rules:
    - High Critical Rule
  emails:
    - a.b@domain.suffix
```


### Rules

A `rule` consists of:

- a unique identifiable name
- `severity`/`priority`: a comma-seperated list of severity/priority ranges (must exist in the Central Security Policy), 
- `minCount`:number describing the minimum amount of vulnerabilities, within the defined severity/priority range, belonging to an **Assessment Context**, before a rule evaluates to `true` 
- `notificationText`: a content body added to the resulting JSON, describing as to why the rule was triggered  

There are several rules that are created by default using the severity ranges specified in the Central Security Policy.
<!-- TODO: provide example and general schema -->

<details>
<summary>Click to show the full json schema</summary>

```json
{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://www.metaeffekt.com/schema/artifact-analysis/latest/overview-notification-rules.json",
  "title": "Notification Rules",
  "description": "Rules specification for the automatic notification in the 'Inventory Overview Report'",
  "type": "object",
  "patternProperties": {
    ".*": {
      "properties": {
        "severity": {
          "type": "string"
        },
        "priority": {
          "type": "string"
        },
        "minCount": {
          "type": "number"
        },
        "mode": {
          "type": "string"
        },
        "notificationText": {
          "type": "string"
        }
      },
      "anyOf": [
        {
          "required": [
            "severity"
          ]
        },
        {
          "required": [
            "priority"
          ]
        }
      ],
      "required": [
        "minCount",
        "notificationText"
      ],
      "additionalProperties": false
    }
  }
}
```

</details>

Example:
```yaml
High Critical Rule:
  severity: High, Critical
  minCount: 1
  notificationText: "You have $[minCount] vulnerabilities with a severity of $[severity]"

```

The content body (`notificationText`) allows templating certain fields which are filled during the evaluation of a trigger condition.
The fields are the following:

- severity: The severity ranges configured by the triggering condition | e.g. [High, Critical]
- priority: The priority ranges configured by the triggering condition | e.g. [Due] (Not available right now)
- minCount: The minimum amount of vulnerabilities required, configured by the triggering condition | e.g. 4
- sourceFile: Source file in which the notification configured is defined | e.g. highCriticalCountTest.yaml
- ruleName: The defined name of the triggering condition | e.g. High Critical Rule
- notificationName: The defined name of the configuration using the triggering condition | e.g. Config-01
- groups: Generalized grouping descriptor for the to-notify parties | e.g. [Group-A]
- audiences: **Assessment Context** considered by the notification rule | e.g. [Audience-A]

### Resulting Json

Example:
```json
[
  {
    "emails": [
      "a.b@domain.suffix"
    ],
    "reason": [
      "Found 18 vulnerabilities in severity range [Medium]"
    ],
    "notificationId": "Config-02"
  },
  {
    "emails": [
      "a.b@domain.suffix"
    ],
    "reason": [
      "Extra"
    ],
    "notificationId": "Config-01"
  }
]
```
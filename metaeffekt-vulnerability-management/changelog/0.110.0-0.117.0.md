# Changelog 0.110.0 - 0.117.0

<!-- TOC -->

* [Summary](#summary)
* [Artifact Analysis / Vulnerability Monitoring / Dashboard](#artifact-analysis--vulnerability-monitoring--dashboard-1)
    * [Content Identifier system refactor](#content-identifier-system-refactor)
    * [Advisor periodic vulnerabilities inclusion based on date](#advisor-periodic-vulnerabilities-inclusion-based-on-date)
    * [Customizable VAD title/subtitle](#customizable-vad-titlesubtitle)
    * [CycloneDX Converter Id/Component format, type information](#cyclonedx-converter-idcomponent-format-type-information)
    * [Redefine Priority Score](#redefine-priority-score)
        * [Issues with Old System](#issues-with-old-system)
        * [New System](#new-system)
        * [Priority Labels](#priority-labels)
        * [How it's used in the VAD](#how-its-used-in-the-vad)
        * [Configuration](#configuration)
    * [VAD Timeline Section](#vad-timeline-section)
    * [Advisor Periodic Query period upper bound](#advisor-periodic-query-period-upper-bound)
    * [CERT-FR JSON endpoint](#cert-fr-json-endpoint)
    * [Correlation transformer](#correlation-transformer)
    * [Fixed EPSS data not being displayed correctly on non-english systems](#fixed-epss-data-not-being-displayed-correctly-on-non-english-systems)
* [Core / Vulnerability Report](#core--vulnerability-report-1)
    * [Include asset path / undo asset name capitalization](#include-asset-path--undo-asset-name-capitalization)
    * [Include advisory generation timestamp](#include-advisory-generation-timestamp)
    * [Redefine Priority Score](#redefine-priority-score-1)
    * [Content Identifier system refactor](#content-identifier-system-refactor-1)
    * [vulnerability detail ordering, vulnerability status sections as topics](#vulnerability-detail-ordering-vulnerability-status-sections-as-topics)
    * [Organize (summary) overview table by group](#organize-summary-overview-table-by-group)
    * [CVSS 3.0 support](#cvss-30-support)
* [Correlation](#correlation)
* [Universal CVSS Calculator](#universal-cvss-calculator)
    * [User guide support for most of the environmental components](#user-guide-support-for-most-of-the-environmental-components)
    * [Version 1.0.2 released](#version-102-released)

<!-- TOC -->

The old documentation for the 1.x and 2.x versions has also been migrated to the latest 3.x version,
which is now available on this here repository:
https://github.com/org-metaeffekt/metaeffekt-documentation/blob/main/metaeffekt-vulnerability-management/vulnerability-management.md

# Summary

## Artifact Analysis / Vulnerability Monitoring / Dashboard

- **Content Identifier System Refactor**: Improved clarity and flexibility by introducing an `implementation` value to
  specify advisory or vulnerability classes. Manual configuration changes are required.
- **Advisor Periodic Vulnerabilities Inclusion Based on Date**: Added the `includeVulnerabilitiesChangedSince` parameter
  to ensure vulnerabilities with creation or update dates remain in the inventory, even if they have no related
  advisories in the query period.
- **Customizable VAD Title and Subtitle**: Enabled customization of the Vulnerability Assessment Dashboard (VAD) through
  the `vad-customization` entry in inventory info. Users can set custom titles, subtitles, and footers using the new
  `set-inventory-info` goal in the `ae-inventory-enrichment-plugin`.
- **CycloneDX Converter Enhancements**: Updated the CycloneDX converter to format `Id` and `Component` fields
  consistently with other generators. It now also uses component type and PURL type to derive the artifact type for the
  inventory.
- **Redefined Priority Score Calculation**: Overhauled the priority scoring system to a multifactor approach that
  includes Base Score (from CVSS vectors), Keyword Score, EPSS Score, KEV Score, and EOL Score. Introduced priority
  labels like "escalate," "due," and "elevated" for better vulnerability prioritization. Configuration is available via
  the Central Security Policy.
- **VAD Timeline Section**: Moved timelines to a separate section in the VAD, allowing independent toggling from
  artifact views.
- **Advisor Periodic Query Period Upper Bound**: Introduced `changedSince` and `changedUntil` parameters to specify date
  ranges for security advisories, allowing for the generation of static views.
- **CERT-FR JSON Endpoint**: Changed the URL for the `CERT_FR_ARCHIVE` resource to use the JSON endpoint, providing a
  more reliable data parsing method.
- **Correlation Transformer**: Added a `correlation-transform` plugin to modify correlation files based on
  transformation rules defined in JSON. Supports operations like renaming fields, setting or removing field values, and
  pattern-based replacements.
- **Fixed EPSS Data Display Issue**: Resolved an issue where EPSS data was not displayed correctly on non-English
  systems.

## Core / Vulnerability Report

- **Asset Path Inclusion and Name Formatting**: The asset overview table now includes the asset path, and asset names
  are no longer capitalized by default, improving readability.
- **Report properties: Advisory Generation Timestamp**: When the inventory contains enrichment steps, the advisory
  generation timestamp is now included, allowing others to read the data.
- **Content Identifier System Refactor**: See above.
- **Redefined Priority Score in Reports**: See above.
- **Vulnerability Detail Ordering and Status Topics**: Vulnerabilities are now ordered descending by CVE-ID, and
  vulnerability statuses like "affected" are displayed as topics in the table of contents for easier navigation.
- **Organized Summary Overview Table by Group**: The "Vulnerabilities by Asset" table is now grouped by the
  `Asset Group` attribute, with unnamed assets grouped under "Other Assets," improving the organization of the report.
- **CVSS 3.0 Support**: Added support for CVSS version 3.0, expanding compatibility with different vulnerability scoring
  systems.

Detailed explanation can be found below.

# Artifact Analysis / Vulnerability Monitoring / Dashboard

### Content Identifier system refactor

The old ContentIdentifiers system has a bunch of flaws:

- Advisories, vulnerabilities and other data sources or even just placeholder values are all collected in the same
  class. This means that if an access to the class is made, it is not definitely clear that an advisory provider,
  vulnerability provider or something else is returned.
  This makes the identification of new types difficult.

- The new CSAF format requires new types being created dynamically. Whilst this is possible with the system right now,
  the current system would still only identify an unregistered “RHSA” entry as a generic advisory entry, which loses
  almost all benefit of the CSAF format.

The new Content Identifier system addresses these issues by introducing a new `implementation` value, that specifies
what advisory/vulnerability class should be used to construct an instance of this entry.

This means that the inventory and pom configuration need some changes.

The inventory now no longer stores the referenced vulnerabilities/advisories/etc in the `Referenced Ids` field, but in a
`Referenced Advisories` or `Referenced Vulnerabilities` field.

Previously:

```json
{
  "MSRC": [
    "MSRC-CVE-2023-50387"
  ],
  "CERT_FR": [
    "CERTFR-2024-AVI-0128",
    "CERTFR-2024-AVI-0122"
  ],
  "GHSA": [
    "GHSA-8459-gg55-8qjj"
  ]
}
```

New:

```json
[
  {
    "implementation": "MSRC",
    "name": "MSRC",
    "id": "MSRC-CVE-2023-50387"
  },
  {
    "implementation": "CERT_FR",
    "name": "CERT_FR",
    "id": "CERTFR-2024-AVI-0128"
  },
  {
    "implementation": "CERT_FR",
    "name": "CERT_FR",
    "id": "CERTFR-2024-AVI-0122"
  },
  {
    "implementation": "GHSA",
    "name": "GHSA",
    "id": "GHSA-8459-gg55-8qjj"
  }
]
```

This change is backwards and frontwards compatible, as the old field is still populated and parsed. _This_ change
requires no manual changes.

This is in contrast to the config changes, which are required to be completed manually. See the link above to the wiki
for more details.
They mainly condense down to the content identifier parameters being changed from a `List<String>` to a
`List<Map<String, String>>` disguised in a `JSONArray`. The format for each array entry is the same as in the
inventories, using a `name` and `implementation` key for identifying what type the entry represents.

Old format:

```xml
<advisoryProviders>
    <entry>CERT_FR</entry>
    <entry>CERT_SEI</entry>
    <entry>RHSA</entry> <!-- this poses an issue, CSAF must be hard-coded! -->
</advisoryProviders>
```

New format:

```json
[
  {
    "name": "CERT_FR"
  },
  {
    "name": "CERT_SEI"
  },
  {
    "name": "RHSA",
    "implementation": "CSAF"
  }
]
```

The additional implementation information serves the use, as stated above, to allow to correctly instantiate advisory
types even if their names are not unique to the advisory provider implementation class, since the implementation will
overwrite the name parameter when searching for existing implementation classes.

| **Class / Process**                                                                                                                        | **Old**                                                                                                                           | **New**                                                                                                                                              |
|--------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| AEAA  <br>AdvisorPeriodicEnrichmentConfiguration                                                                                           | List<String> vulnerabilityAdvisoryFilter = new ArrayList<>();                                                                     | JSONArray vulnerabilityAdvisoryFilter = new JSONArray();                                                                                             |
| Collection<String> advisoryProviders = new ArrayList<>(Collections.singletonList("all"));                                                  | JSONArray advisoryProviders = new JSONArray()  <br>.put(new JSONObject().put("name", "all").put("implementation", "all"));        |
| AEAA  <br>VulnerabilityAssessmentDashboardEnrichmentConfiguration                                                                          | Set<String> failOnUnreviewedAdvisoriesTypes = new HashSet<>();                                                                    | JSONArray failOnUnreviewedAdvisoriesTypes = new JSONArray();                                                                                         |
| AEAA  <br>MergeAdvisorInventoriesMojo                                                                                                      | String vulnerabilityAdvisoryFilter;                                                                                               | JSONArray vulnerabilityAdvisoryFilter = new JSONArray();                                                                                             |
| Core  <br>CentralSecurityPolicyConfiguration  <br>(we really REALLY need to move all data vulnerability data classes into a single module) | List<String> includeVulnerabilitiesWithAdvisoryProviders = new ArrayList<>(Collections.singletonList("all"));                     | JSONArray includeVulnerabilitiesWithAdvisoryProviders = new JSONArray()  <br>.put(new JSONObject().put("name", "all").put("implementation", "all")); |
| List<String> includeAdvisoryProviders = new ArrayList<>(Collections.singletonList("all"));                                                 | JSONArray includeAdvisoryProviders = new JSONArray()  <br>.put(new JSONObject().put("name", "all").put("implementation", "all")); |
| Core  <br>AbstractInventoryReportCreationMojo                                                                                              | List<String> generateOverviewTablesForAdvisories = new ArrayList<>();                                                             | JSONArray generateOverviewTablesForAdvisories = new JSONArray();                                                                                     |

### Advisor periodic vulnerabilities inclusion based on date

A few months ago, the CERT-FR stopped working due to unannounced data format and API changes. This lead to the periodic
report no longer providing useful (or in fact, any) information.

Therefore, another change in this PR is the `includeVulnerabilitiesChangedSince` parameter in the
`AdvisorPeriodicEnrichmentConfiguration`, which forces any vulnerability with a create or update date to remain in the
inventory, no matter what the other filters would say otherwise.

This will ensure that no matter what, information will still be transported by the report.

### Customizable VAD title/subtitle

This PR enables several options for customizing the VAD contents.  
This is done via an inventory info entry with the id `vad-customization`. It has multiple keys:

- `Title` which overwrites the title of the VAD
- `Subtitle` is similar to the title, adding a text in the header with a smaller font
- `Footer` which adds a new badge to the bottom left of the VAD.

The required inventory info fields can be filled via a new `set-inventory-info` goal in the
`ae-inventory-enrichment-plugin`, which takes an entry id and several values that can be filled into the inventory info
of an inventory. In a real process, I would recommend setting the input and output inventories to the same file to edit
it in place to reduce the amount of inventories that are produced.

See examples below:

![Screenshot 2024-07-30 at 13 03 43](https://github.com/user-attachments/assets/c5ed664e-b508-405c-9843-c15326299154)

![Screenshot 2024-07-30 at 10 37 17](https://github.com/user-attachments/assets/ab13004d-ba9f-4cf2-bb90-e1eed80c452d)

---

Below is an example configuration. It assumes that `source-inventory.xls` already contains vulnerability information.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>test</groupId>
    <artifactId>test</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    <packaging>jar</packaging>

    <build>
        <plugins>
            <plugin>
                <groupId>com.metaeffekt.artifact.analysis</groupId>
                <artifactId>ae-inventory-enrichment-plugin</artifactId>
                <version>HEAD-SNAPSHOT</version>
                <executions>
                    <execution>
                        <id>set-inventory-info</id>
                        <goals>
                            <goal>set-inventory-info</goal>
                        </goals>
                        <configuration>
                            <active>true</active>

                            <entryId>vad-customization</entryId>
                            <values>
                                <Title>My custom dashboard</Title>
                                <Subtitle>v2.53.2-20240729b</Subtitle>
                                <Footer>Some more information in a badge</Footer>
                            </values>

                            <inventoryInputFile>
                                source-inventory.xls
                            </inventoryInputFile>

                            <inventoryOutputFile>
                                filled-inventory.xls
                            </inventoryOutputFile>
                        </configuration>
                    </execution>

                    <execution>
                        <id>enrich-inventory</id>
                        <goals>
                            <goal>enrich-inventory</goal>
                        </goals>

                        <configuration>
                            <mirrorDirectory>
                                mirror
                            </mirrorDirectory>

                            <inventoryInputFile>
                                filled-inventory.xls
                            </inventoryInputFile>
                            <inventoryOutputFile>
                                enriched-inventory.xls
                            </inventoryOutputFile>
                            <writeIntermediateInventories>false</writeIntermediateInventories>

                            <vulnerabilityAssessmentDashboardEnrichment>
                                <vulnerabilityTimelinesGlobalEnabled>false</vulnerabilityTimelinesGlobalEnabled>
                                <outputDashboardFile>
                                    dashboard.html
                                </outputDashboardFile>
                            </vulnerabilityAssessmentDashboardEnrichment>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
```

### CycloneDX Converter Id/Component format, type information

The CycloneDX converter will now:

- format `Id` and `Component` more consistently with the metaeffekt standards (this requires a change of correlation
  data)
- use the information on the component type and the purl type to derive an artifact type for the inventory.

### Redefine Priority Score

This pull request introduces a comprehensive refactor and enhancement of the existing vulnerability priority score
calculation mechanism. The previous scoring system has been replaced with an extended and more flexible approach.

#### Issues with Old System

- The previous system primarily relied on a simpler calculation method, only relying on the CVSS and keyword scores,
  displaying the sum of both. This might be useful in certain cases, but already requires the manual work of creating
  keyword files and considering which of these are relevant for the CVE data present.
- VAD: The data was spread out across multiple sections, would use up a lot of vertical space.
- VAD: Each section was formatted entirely differently, making it hard to quickly read out what state something is in.
- VAD: If no data was present for a factor, it's section simply did not appear in the VAD. The absence of something as a
  state indicator makes it harder to identify this state for a human, since they now need to remember that this metric
  existed in the first place to notice it's absence.
- VAD: A score would be calculated and displayed not matter whether it was raised from the base CVSS score, making it
  harder to identify actually higher ranked priority scores in the overview table.
- VR: No priority score present at all in the VR, some metrics are not even displayed (like EOL or keywords). These will
  be added on the CORE-side of this PR.

#### New Priority Score System

The new priority score calculation replaces the old system with a multi-faceted approach that accounts for a broader
range of factors:

1. **Base Score**

The base score is now determined by the first available value from either the "Context CVSS" or "Initial CVSS" vector.
This CVSS data is used as the foundation for the priority score that all others are added to.

2. **Keyword Score**

Keyword scores, derived from relevant manually defined keyword sets, are added to the base score. This is unchanged to
the previous priority score behavior.

3. **EPSS Score**

The EPSS score ('p') is transformed into a linear additive factor. If 'p' is below a defined minimum threshold ('min'),
it contributes 0 to the score. Otherwise, the score is calculated using the following linear interpolation formula:

    addend<sub>EPSS</sub>(p) = 0 | 0 <= p <= min 
                             = f + ((p - min) / (1.0 - min)) * (F - f) | for min < p <= 1.0


This describes a truncated linear function, meaning it allows for fully ignoring the lower ranges and returning a custom
linearely scaled value for the higher ones.

4. **KEV Score**

A predefined score is added if a known exploit exists, with an additional increment if ransomware is associated with the
vulnerability.

5. **EOL Score**

The EOL score is based on the software's lifecycle states that are affected by the relevant vulnerability, with distinct
scores for scenarios with and without extended support.

The new calculation method adds additional context to a previously not-so-useful score, allowing for a more accurate
vulnerability prioritization. The formulas implemented allow full customization of the scores added to the overall
priority score.

#### Priority Labels

The new priority system introduces a new CVSS Severity Range, the `priorityScoreSeverityRanges`, responsible for
creating labels indicating risk potential the reports. Three labels/ranges are defined by default:

- escalate (9.0 - ∞)
- due (7.0 - 8.9)
- elevated (-∞ - 6.9)

The corresponding labels are rendered in the resulting reports as priority indicators in case the priority score is
greater than the context score. Otherwise, the label 'Default' is rendered as a priority indicator.

#### How it's used in the VAD

The image below shows how the data might be displayed in the Vulnerability Assessment Dashboard.

- All priority score contributing metrics are listed in a table, with their reasoning spelled out, to explain the scores
  on the left.
- All metrics are always present, though empty if not filled.
- Indicators are added, if the metric contributes to the score.

<img width="1016" alt="Screenshot 2024-08-19 at 08 30 29" src="https://github.com/user-attachments/assets/3ed590ab-5822-48fb-b2c6-44a576f61f95">

#### Configuration

Every part of this new process is configurable via the Central Security Policy.

- `priorityScoreSeverityRanges`
  The severity ranges to use when calculating the labels for the priority score of a vulnerability. It will be displayed
  alongside the score. The default value is:
  `escalate:strong-red:9.0:,due:strong-dark-orange:7.0:8.9,elevated:strong-light-orange::6.9`

- `priorityScoreConfiguration`
  Has three properties `epss`, `kev`, `eol`, each with parameters for the functions used in the calculations. The
  default values are as of now (to be defined):
  ```json
  {
    "eol": {
      "noExtendedSupport": {
        "supportValid": 0,
        "supportEndingSoon": 3
        "supportExpired": 4
      },
      "extendedSupport": {
        "supportValid": 0,
        "supportEndingSoon": 1,
        "extendedSupportValid": 2
        "extendedSupportEndingSoon": 3,
        "extendedSupportExpired": 4
      }
    },
    "epss": {
      "min": 0.5,
      "f": 0.5,
      "F": 1
    },
    "kev": {
      "exploit": 2,
      "ransomware": 1
    }
  }
  ```

The amount of vulnerabilities in the `escalate` and `due` ranges (priority score) is also visible in the Vulnerability
Assessment Dashboard using the bottom left badges.

![Screenshot 2024-09-17 at 13 13 08](https://github.com/user-attachments/assets/0431fccf-6ab7-4f1b-9c8c-178d1ff9966e)

This metric adjusts based on the configured priority ranges. They exclude the lowest severity range and only consider
the vulnerabilities that have an elevated priority score to reduce complexity.

### VAD Timeline Section

The Timelines are now a separate section in the VAD, to allow toggling them separately from the artifacts.

### Advisor Periodic Query period upper bound

Using a combination of the `changedSince` and `changedUntil` parameters, you can now specify exactly from when to when
the security advisories should be queried for.
This is useful for generating static views, like the example report in the documentation template.

```xml

<advisorPeriodicEnrichment>
    <active>true</active>

    <changedSince>2021-05-01</changedSince>
    <changedUntil>2022-05-01</changedUntil>

    <advisoryProviders>
        [{"name":"CERT_FR"}, {"name":"CERT_SEI"}, {"name":"CERT_EU"}]
    </advisoryProviders>
</advisorPeriodicEnrichment>
```

```
[INFO] --------------------------< Advisor periodic >--------------------------
[INFO] Enriching inventory with [8 artifacts], [100 vulnerabilities] and [120 advisories]
[INFO] Configuration [advisor-periodic]:
[INFO]   advisoryProviders: [{"name":"CERT_FR"},{"name":"CERT_SEI"},{"name":"CERT_EU"}]
[INFO]   changedSince: 2021-05-01
[INFO]   changedSinceTimestamp: 1619827200000
[INFO]   changedUntil: 2022-05-01
[INFO]   changedUntilTimestamp: 1651363200000
...
[INFO] Using [initial] as the only reference inventory
[INFO] Listing all advisories for changed entries of [CERT_FR, CERT_SEI, CERT_EU] in period [2021-05-01 (3 years and 5 months ago) - 2022-05-01 (2 years and 4 months ago)]
[INFO] Querying the advisory index for [types=[all]] [provider=CERT_FR] [queryPeriod=[2021-05-01 (3 years and 5 months ago) - 2022-05-01 (2 years and 4 months ago)]]
[INFO] Found [1072] security advisories for [CertFrAdvisorIndexQuery]
[INFO] Querying the advisory index for [types=[all]] [provider=CERT_SEI] [queryPeriod=[2021-05-01 (3 years and 5 months ago) - 2022-05-01 (2 years and 4 months ago)]]
[INFO] Found [22] security advisories for [CertSeiAdvisorIndexQuery]
[INFO] Querying the advisory index for [types=[all]] [provider=CERT_EU] [queryPeriod=[2021-05-01 (3 years and 5 months ago) - 2022-05-01 (2 years and 4 months ago)]]
[INFO] Found [87] security advisories for [CertEuAdvisorIndexQuery]
[INFO] Found a total of [1181] advisories
```

This allows for views like this in the report:

![Screenshot 2024-09-16 at 10 39 11](https://github.com/user-attachments/assets/87896ebc-b9ea-4146-974c-4cb9271bcfad)

### CERT-FR JSON endpoint

Changed the URL for the `CERT_FR_ARCHIVE` resource location from:

- https://metaeffekt.com/mirror/cert-fr/txt/%d.tar

to:

- https://metaeffekt.com/mirror/cert-fr/json/%d.tar

This allows for a more reliable and direct approach to parsing the CERT-FR data.
I'm unsure why the txt path was ever used in here. The json approach only has advantages compared to it.

### Correlation transformer

Added a `correlation-transform` plugin, which adds support for modifying a set of correlation files based on
transformation rules defined in a JSON Object.

The `ArtifactCorrelationEntryTransformer` class applies a series of transformation instructions to link
ArtifactCorrelationEntry instances. It supports operations such as renaming fields, setting field values, removing
fields, and replacing field values based on patterns.

Usage example:

```
ArtifactCorrelationEntryTransformer transformer = new ArtifactCorrelationEntryTransformer();
transformer.addInstruction(new TransformationInstruction.RenameOperation("matcher/affects/Id", "Component"));
transformer.transformInPlace(artifactCorrelationEntry);
```

The transformer can be configured with a set of `TransformationInstruction` instances. Each instruction can optionally
include an artifact filter to apply transformations only to matching artifacts.

Valid access paths for transformation instructions are:

* `matcher/affects`
* `matcher/ignores`
* `matcher/affectsFn`
* `matcher/ignoresFn`
* `apply/append`
* `apply/remove`
* `apply/overwrite`
* `apply/clear`

See the `correlation-transformer.json` schema for more information on the available transformation instructions.

An example POM configuration is:

```xml

<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.metaeffekt.test</groupId>
    <artifactId>correlation-transform-plugin-test</artifactId>
    <version>HEAD-SNAPSHOT</version>

    <build>
        <plugins>
            <plugin>
                <groupId>com.metaeffekt.artifact.analysis</groupId>
                <artifactId>ae-inventory-enrichment-plugin</artifactId>
                <version>HEAD-SNAPSHOT</version>
                <executions>
                    <execution>
                        <id>transform-correlation-files</id>
                        <goals>
                            <goal>correlation-transform</goal>
                        </goals>
                        <configuration>
                            <inputDirectory>input</inputDirectory>
                            <outputDirectory>target</outputDirectory>
                            <transformerConfiguration><![CDATA[
                                [{"selectionPath":"matcher/affects/Component","newName":"Group Id","type":"RenameOperation","artifactFilter":[{"Id":"bridge-jbossxts-2.3.4.jar","Group Id":"org.jboss.narayana.xts"}]},{"selectionPath":"matcher/affects/Component","newName":"Id","type":"RenameOperation"},{"selectionPath":"apply/append/Append 1","type":"RemoveFieldOperation"},{"selectionPath":"matcher/affects/New Attribute","addIfNotPresent":true,"type":"SetFieldOperation","fieldValue":"new value 1"},{"selectionPath":"matcher/affects/Some other field","addIfNotPresent":false,"type":"SetFieldOperation","fieldValue":"new value 2"},{"selectionPath":"apply/append/Inapplicable CPE URIs","pattern":"(.+)","type":"ReplaceFieldOperation","replacement":"$1, cpe:/a:vendor:product:version","artifactFilter":[{"New Attribute":"new value 1","Id":"bridge-jbossxts-2.3.4.jar","Group Id":"org.jboss.narayana.xts"}]}]
                            ]]></transformerConfiguration>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
```

which, when applied to this YAML:

```yaml
- affects:
    - Id: jansi*.jar
    - Component: JanSi
  append:
    Additional CPE URIs: cpe:/a:fusesource:jansi

- affects:
    - Id: bridge-*.jar
      Component: JBoss Narayana
    - Id: bridge-*.jar
      Group Id: org.jboss.narayana.xts
  append:
    Inapplicable CPE URIs: cpe:/a:adobe:bridge, cpe:/a:lg:bridge, cpe:/a:qodeinteractive:bridge, cpe:/a:trezor:bridge, cpe:/a:edwiser:bridge

- affects:
    Some other field: test
  append:
    Append 1: test
    Append 2: test
```

produces this output:

```yaml
- affects:
    - New Attribute: new value 1
      Some other field: new value 2
      Id: /jansi.*\.jar/
    - New Attribute: new value 1
      Some other field: new value 2
      Id: JanSi
  append:
    Additional CPE URIs: cpe:/a:fusesource:jansi
- affects:
    - New Attribute: new value 1
      Some other field: new value 2
      Id: /bridge-.*\.jar/
      Group Id: JBoss Narayana
    - New Attribute: new value 1
      Some other field: new value 2
      Id: /bridge-.*\.jar/
      Group Id: org.jboss.narayana.xts
  append:
    Inapplicable CPE URIs: cpe:/a:adobe:bridge, cpe:/a:lg:bridge, cpe:/a:qodeinteractive:bridge,
      cpe:/a:trezor:bridge, cpe:/a:edwiser:bridge
- affects:
    - New Attribute: new value 1
      Some other field: new value 2
  append:
    Append 2: test
```

---

A JSON Schema file `correlation-transformer.json` (and a list version `correlation-transformer-list.json`) have been
added to the schemas directory. You can view them online at their regular endpoints.
This means, the data on the server must be updated once again.

### Fixed EPSS data not being displayed correctly on non-english systems

# Core / Vulnerability Report

### Include asset path / undo asset name capitalization

The asset overview table now contains the asset path and the name is no longer capitalized by default.

![Screenshot 2024-09-17 at 09 27 55](https://github.com/user-attachments/assets/246dfc9f-0d94-44b2-a3ef-0269afb4aaeb)

### Include advisory generation timestamp

If an inventory contains at least one inventory enrichment step in the inventory info sheet under the
`inventory-enrichment` --> `Steps` section, the following properties will be filled with the relevant values (otherwise
empty):

```properties
ae.vulnerability.advisor.time.step.first.timestamp=1722943394056
ae.vulnerability.advisor.time.step.first.en=06/08/2024 13:23
ae.vulnerability.advisor.time.step.first.de=06.08.2024 13:23
ae.vulnerability.advisor.time.step.latest.timestamp=1722943402863
ae.vulnerability.advisor.time.step.latest.en=06/08/2024 13:23
ae.vulnerability.advisor.time.step.latest.de=06.08.2024 13:23
```

### Redefine Priority Score

See the artifact analysis chapter above for more details on calculation and configuration of the new priority score.

![Screenshot 2024-08-22 at 09 16 38](https://github.com/user-attachments/assets/442fd043-5a37-4f15-8fcd-aa12f15cb54e)

### Content Identifier system refactor

This PR mirrors the changes made in artifact analysis chapter mentioned above to the vulnerability PDF report.
A short summary:

The old ContentIdentifiers system has a bunch of flaws:

- Advisories, vulnerabilities and other data sources or even just placeholder values are all collected in the same
  class. This means that if an access to the class is made, it is not definitely clear that an advisory provider,
  vulnerability provider or something else is returned.
  This makes the identification of new types difficult.

- The new CSAF format requires new types being created dynamically. Whilst this is possible with the system right now,
  the current system would still only identify an unregistered “RHSA” entry as a generic advisory entry, which loses
  almost all benefit of the CSAF format.  
  This also applies to the OSV data sources.

### vulnerability detail ordering, vulnerability status sections as topics

Vulnerabilities are now ordered descending by CVE-Id and "affected", etc. are now displayed as topics in the toc.

![Screenshot 2024-08-22 at 09 19 28](https://github.com/user-attachments/assets/f153b873-c3f4-4f46-bd99-af86f3440e6a)

![Screenshot 2024-08-22 at 09 19 20](https://github.com/user-attachments/assets/c58667d6-1796-469d-aa3d-fc161c1f07d9)

### Organize (summary) overview table by group

The Vulnerabilities by Asset table will now be split into (potentially) multiple tables, grouped by an `Asset Group`
attribute in the Asset data. Unnamed Assets will be grouped into a generic `Other Assets` group.

| Asset Id                    | Name            | Asset Group |
|-----------------------------|-----------------|-------------|
| CID-kmc-audit-3.6.0         | KMC Audit 3.6.0 | Group 1     |
| CID-kmc-audit-3.7.0-RC3     |                 | Group 2     |
| CID-kmc-enrolment-3.6.0     |                 | Group 2     |
| CID-kmc-inventory-3.6.0     |                 |             |
| CID-kmc-inventory-3.7.0-RC3 |                 |             |

with added assessment information will result in these three tables:

![Screenshot 2024-08-23 at 12 39 52](https://github.com/user-attachments/assets/468ff8d5-9bb4-4013-ab2c-7f3cd2b86c36)

Another change: If no `Name` attribute is present on the Assets, it will now fall back to the `Asset Id` instead of
showing a blank string.

### CVSS 3.0 support

This will most likely never be used, but we now support it.

# Correlation

Summary of changes:

- Keycloak 25.0.0 (reference project)
- GDP, GDP microservices
- microsoft inventory
- automatic generation of 1100 Node.js modules correlation entries
- renaming of node-js module to web-module, added regex matching
- added missing eol entries

# Universal CVSS Calculator

### User guide support for most of the environmental components

### Version 1.0.2 released

https://www.npmjs.com/package/ae-cvss-calculator

> [Documentation](../../README.md) >
> [Vulnerability Management](../vulnerability-management.md) >
> Data Formats >
> Correlation Transformer

# Correlation Transformer

A `correlation-transform` plugin is available, which adds support for modifying a set of correlation files based on
transformation rules defined in a JSON Object.

The `ArtifactCorrelationEntryTransformer` class applies a series of transformation instructions to link
ArtifactCorrelationEntry instances. It supports operations such as renaming fields, setting field values, removing
fields, and replacing field values based on patterns.

Usage example:

```java
ArtifactCorrelationEntryTransformer transformer = new ArtifactCorrelationEntryTransformer();
transformer.addInstruction(new TransformationInstruction.RenameOperation("matcher/affects/Id", "Component"));
transformer.transformInPlace(artifactCorrelationEntry);
```

The transformer can be configured with a set of `TransformationInstruction` instances. Each instruction can optionally
include an artifact filter to apply transformations only to matching artifacts.

Valid access paths for transformation instructions are:

* `matcher/affects`
* `matcher/ignores`
* `matcher/affectsFn`
* `matcher/ignoresFn`
* `apply/append`
* `apply/remove`
* `apply/overwrite`
* `apply/clear`

See the `correlation-transformer.json` schema for more information on the available transformation instructions.

An example POM configuration using the following JSON:

```json
[
  {
    "selectionPath": "matcher/affects/Component",
    "newName": "Group Id",
    "type": "RenameOperation",
    "artifactFilter": [
      {
        "Id": "bridge-jbossxts-2.3.4.jar",
        "Group Id": "org.jboss.narayana.xts"
      }
    ]
  },
  {
    "selectionPath": "matcher/affects/Component",
    "newName": "Id",
    "type": "RenameOperation"
  },
  {
    "selectionPath": "apply/append/Append 1",
    "type": "RemoveFieldOperation"
  },
  {
    "selectionPath": "matcher/affects/New Attribute",
    "addIfNotPresent": true,
    "type": "SetFieldOperation",
    "fieldValue": "new value 1"
  },
  {
    "selectionPath": "matcher/affects/Some other field",
    "addIfNotPresent": false,
    "type": "SetFieldOperation",
    "fieldValue": "new value 2"
  },
  {
    "selectionPath": "apply/append/Inapplicable CPE URIs",
    "pattern": "(.+)",
    "type": "ReplaceFieldOperation",
    "replacement": "$1, cpe:/a:vendor:product:version",
    "artifactFilter": [
      {
        "New Attribute": "new value 1",
        "Id": "bridge-jbossxts-2.3.4.jar",
        "Group Id": "org.jboss.narayana.xts"
      }
    ]
  }
]
```

```xml

<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.metaeffekt.test</groupId>
    <artifactId>correlation-transform-plugin-test</artifactId>
    <version>HEAD-SNAPSHOT</version>

    <build>
        <plugins>
            <plugin>
                <groupId>com.metaeffekt.artifact.analysis</groupId>
                <artifactId>ae-inventory-enrichment-plugin</artifactId>
                <version>HEAD-SNAPSHOT</version>
                <executions>
                    <execution>
                        <id>transform-correlation-files</id>
                        <goals>
                            <goal>correlation-transform</goal>
                        </goals>
                        <configuration>
                            <inputDirectory>input</inputDirectory>
                            <outputDirectory>target</outputDirectory>
                            <transformerConfiguration><![CDATA[
                                [{"selectionPath":"matcher/affects/Component","newName":"Group Id","type":"RenameOperation","artifactFilter":[{"Id":"bridge-jbossxts-2.3.4.jar","Group Id":"org.jboss.narayana.xts"}]},{"selectionPath":"matcher/affects/Component","newName":"Id","type":"RenameOperation"},{"selectionPath":"apply/append/Append 1","type":"RemoveFieldOperation"},{"selectionPath":"matcher/affects/New Attribute","addIfNotPresent":true,"type":"SetFieldOperation","fieldValue":"new value 1"},{"selectionPath":"matcher/affects/Some other field","addIfNotPresent":false,"type":"SetFieldOperation","fieldValue":"new value 2"},{"selectionPath":"apply/append/Inapplicable CPE URIs","pattern":"(.+)","type":"ReplaceFieldOperation","replacement":"$1, cpe:/a:vendor:product:version","artifactFilter":[{"New Attribute":"new value 1","Id":"bridge-jbossxts-2.3.4.jar","Group Id":"org.jboss.narayana.xts"}]}]
                            ]]></transformerConfiguration>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
```

which, when applied to this YAML:

```yaml
- affects:
    - Id: jansi*.jar
    - Component: JanSi
  append:
    Additional CPE URIs: cpe:/a:fusesource:jansi

- affects:
    - Id: bridge-*.jar
      Component: JBoss Narayana
    - Id: bridge-*.jar
      Group Id: org.jboss.narayana.xts
  append:
    Inapplicable CPE URIs: cpe:/a:adobe:bridge, cpe:/a:lg:bridge, cpe:/a:qodeinteractive:bridge, cpe:/a:trezor:bridge, cpe:/a:edwiser:bridge

- affects:
    Some other field: test
  append:
    Append 1: test
    Append 2: test
```

produces this output:

```yaml
- affects:
    - New Attribute: new value 1
      Some other field: new value 2
      Id: /jansi.*\.jar/
    - New Attribute: new value 1
      Some other field: new value 2
      Id: JanSi
  append:
    Additional CPE URIs: cpe:/a:fusesource:jansi
- affects:
    - New Attribute: new value 1
      Some other field: new value 2
      Id: /bridge-.*\.jar/
      Group Id: JBoss Narayana
    - New Attribute: new value 1
      Some other field: new value 2
      Id: /bridge-.*\.jar/
      Group Id: org.jboss.narayana.xts
  append:
    Inapplicable CPE URIs: cpe:/a:adobe:bridge, cpe:/a:lg:bridge, cpe:/a:qodeinteractive:bridge,
      cpe:/a:trezor:bridge, cpe:/a:edwiser:bridge
- affects:
    - New Attribute: new value 1
      Some other field: new value 2
  append:
    Append 2: test
```

---

A JSON Schema file `correlation-transformer.json` (and a list version `correlation-transformer-list.json`) have been
added to the schemas directory. You can view them online at their regular endpoints.
This means, the data on the server must be updated once again.
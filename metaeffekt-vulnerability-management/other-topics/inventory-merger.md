> [Documentation](../../README.md) >
> [Vulnerability Management](../vulnerability-management.md) >
> Algorithms and Calculations >
> Inventory Merger

# Inventory Merger (flatten vulnerabilities)

> [Introduction](#introduction) -
> [Merging Process Steps](#merging-process-steps)

## Introduction

The `InventoryMerger` class is responsible for consolidating multiple artifact inventories and
their associated vulnerability data into a single comprehensive inventory.

The process is built to handle scenarios where artifacts, vulnerabilities, and advisories may have different statuses
across various inventories.
As such, it will retain vulnerabilities with the highest severity and information about what advisories are in what
review state.

A `context` here refers to an input inventory that is to be merged into the output inventory.

1. **Artifacts:** Combines artifacts from multiple reference inventories by deduplicating them.
   The information from which source inventory (context) an artifact comes from is retained.
2. **Vulnerabilities:** Vulnerabilities are merged into a single context, the most severe status from all is retained.  
   **Reviewed Advisories:** In the same step, advisories are checked for their review state.
   They are assessed for whether they have been fully reviewed across all inventories,
   incomplete ones are marked accordingly.
3. **Security Advisories:** Merges security advisories, deduplicating them.

## Merging Process Steps

### 1. Include Artifacts

This is the most straightforward step, where artifacts are merged from multiple reference inventories:

- Artifacts are extracted from each reference inventory and iterated over:
    - If an artifact from a reference inventory does not exist in the output inventory,
      it is added with all associated metadata.
    - If an artifact already exists in the output inventory,
      any new context or vulnerability data from the reference inventories is appended.

### 2. Include Vulnerabilities

Vulnerabilities associated with the artifacts are merged based on their severity:

- In a first iteration, the status for each vulnerability across all reference inventories is recorded.
  As such, the vulnerabilities with the most severe status across inventories are identified.
- Move the vulnerabilities with the highest severity into the output inventory.
- Vulnerabilities not yet present in the output inventory but found in the reference inventories are appended.

Then the process checks for the review status of advisories already in this step:

- Advisories marked as `reviewed` are identified in each reference inventory.
- The process checks if an advisory has been reviewed in all inventories. If not, it is marked as unreviewed.
  Only advisories that have been reviewed in all inventories are marked as fully reviewed.

### 3. Include Security Advisories

- All security advisories from the reference inventories are collected and stored in the output inventory.
- Advisories with the same identifiers are merged to avoid duplication.

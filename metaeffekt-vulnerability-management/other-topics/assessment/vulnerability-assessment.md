> [Documentation](../../../README.md) >
> [Vulnerability Management](../../vulnerability-management.md) >
> Data Formats >
> Vulnerability Assessment

# Vulnerability Assessment (Generation 4.x, Version 2.x)

The Vulnerability Assessment Format is currently supported in three distinct formats that each differ in their syntax and capabilities.
The following list contains links to pages that each specify further details on the versions and changes to previous versions.
Below this list, a documentation of the latest assessment version can be found.

- [Version 2.1 (Latest)](vulnerability-assessment-file-gen-4-2.1.md)
- [Version 2.0 (First Gen. 4 version)](vulnerability-assessment-file-gen-4-2.0.md)
- [Version 1.0 (Legacy, Gen. 3)](vulnerability-assessment-file-gen-3.md)

## Version 2.1 (Latest)

The vulnerability assessment format YAML and JSON formats allow for the configuration of assessments that will be applied on vulnerabilities to determine their status and add various metadata to the vulnerabilities.

Equivalent examples for both the YAML and JSON formats are provided in the table below.

<table>
<thead>
  <tr>
    <th>YAML</th>
    <th>JSON (reduced)</th>
  </tr>
</thead>
<tbody>
  <tr>
<td valign="top">

```yaml
schema-version: "2.1"

assessments:
- affects:
  vulnerabilities:
    - CVE-2021-4104
  events:
    - date: 2022-01-31
      status: applicable
      rationale: Application configuration allows exploitation.
      cvss:
        - rationale: "Component is only accessible from a trusted internal network."
          modifications:
            - version: "4.0"
              type: "lower metric"
              metrics: "MAV:N"
```

</td>
<td>

```json
{
  "schemaVersion": "2.1",
  "scope": "VULNERABILITY",
  "affects": {
    "affectedVulnerabilities": [ "CVE-2021-4104" ]
  },
  "events": [ {
      "schemaVersion": "2.1",
      "uid": "94513c8c-4b0d-4624-8725-49cc97a7f417",
      "scope": "VULNERABILITY",
      "status": "applicable",
      "rationale": "Application configuration allows exploitation.",
      "date": 1643587200000,
      "priority": 0,
      "cvss": [ {
          "rationale": "Component is only accessible from a trusted internal network.",
          "modifications": [ {
              "version": "4.0", "type": "lower metric", "metrics": "MAV:N"
          } ]
      } ],
      "reviewedAdvisories": []
  } ],
  "ignoreWhenVoid": false
}
```

</td>
  </tr>
</tbody>
</table>

A short summary with all important terms:

**Assessments** are provided by **Assessment YAML/JSON files** or the **[Asset Management Backend](https://github.com/org-metaeffekt/metaeffekt-asset-management)** via the **Dashboard API** in the Dashboard frontend.
Every **Assessment** provides a set of general information on the assessment, such as what **Vulnerabilities, CPEs (and more) the assessment should affect**, certain **Validation Parameters**, the **Scope** and **Creation Context** of the assessment and a list of **Assessment Events**.  
**Assessment Events** are what specify what the effect on a vulnerability should be.
They contain a **Status, Rationales, Measures, CVSS Vectors**, and more.
Events are collected across multiple assessments and evaluated additively in the order they were created, with some exceptions.

## Schema Format Definition

Expand the collapsables below to learn more about the formats.

<details>

<summary><h3>YAML</h3></summary>

The full JSON schema definition of the YAML format is available at https://metaeffekt.com/schema/artifact-analysis.

On the topmost level of the YAML document, the following keys are required:

- `schema-version` (required): Specifies the schema version, must be "2.1" for the latest version.
- `assessments` (required): An array of one or more assessment entries.

### Assessments (`assessments`)

Each assessment defines the following properties:

- `scope`:
    - `vulnerability`: Applies to vulnerabilities specified in the `affects` section.
    - `inventory` ("baseline"): Applies to all vulnerabilities in the inventory (bypasses `affects`).
      `inventory`-scope assessments order below `vulnerability`-scope assessments by default.
- `affects` (mandatory on `vulnerability` scope): Specifies what vulnerabilities to apply the assessment on.
  At least one of the listed elements must match for the entry to be activated.
    - `vulnerabilities`: Array of vulnerability IDs (e.g. `CVE-2021-44228`) to apply the assessment on.
    - `cpe`: Array of CPE 2.2/2.3 strings (e.g. `cpe:/a:apache:log4j`).
    - `cwe`: Array of CWE IDs (e.g. `CWE-502`).
    - `condition`: A well-formed
      [Filter expression](https://github.com/org-metaeffekt/metaeffekt-documentation/blob/main/metaeffekt-vulnerability-management/other-topics/vulnerability-filter-format.md)
      (e.g. `attribute name == "CVE-2020-1234"`).
      Currently only used in the "Auto-Assessment" feature of the MSRC fixes.
      Might be replaced by a different system in the "near future" and should therefore only be used if there is no other way.
    - `labels`: If specified, the labels listed must match in addition to another `affects` criteria.
        - `includes`: At least one of the labels listed is required to match for the assessment to apply.
        - `excludes`: Labels that disqualify the assessment if present.
- `events` (mandatory): See sub-chapter below.
- `ignoreWhenVoid` (optional, default: `false`): Controls how to handle assessments for vulnerabilities that are not
  found in the inventory.
    - `false` (default): If an assessment targets a vulnerability not present in the inventory, a new placeholder entry
      for that vulnerability is created and its status is set to `VOID`.
    - `true`: The assessment is completely ignored if the target vulnerability is not found in the inventory.
- `validation`: See [the validation chapter in this document](vulnerability-assessment-file-gen-3.md#validation) or
  [this example](vulnerability-assessment-file-gen-3.md#ex-5-inventory-validation).

### Assessment Events (`events`)

An array of incremental assessment events.
Events are evaluated in order based on their [intrinsic comparison order](#event-ordering), with later events overriding earlier ones.

Each event must include (required):

- `date`: ISO 8601-alike date (either `2025-01-01`, `2025-01-01 10:00` or `2025-01-01 10:00:00`).

Assessment properties:

- `status`: One of `applicable`, `not applicable`, `insignificant`, or `void`.
- `author`
- `reported`/`accepted`: Identifies who reported/accepted the status.
- `rationale`: Explanation for the status and assessment.
- `risk`
- `measures`
- `score`: setting this property will fully overwrite the priority score displayed in the Vulnerability Assessment
  Dashboard.
- `priority`: Integer to override sorting (higher values take precedence), default: `0`.
- `advisory reviewed`:
    - List of objects with `id` (e.g. `CERTFR-2021-ALE-022`) and `rationale`.
- `cvss`: An array of CVSS modification blocks, supporting versions 2.0, 3.0, 3.1, and 4.0. This "rationale-centric" format groups modifications under a common rationale.
    - `rationale`: An explanation for the set of modifications being applied.
    - `modifications`: An array of modification objects, each with the following properties:
        - `version` (required): The CVSS version string (`2.0`, `3.0`, `3.1`, `4.0`).
        - `type` (required): The type of modification to perform. Valid types include:
            - `reset modification`: Resets one or more metrics to their original values.
            - `overwrite metric`: Sets a specific metric to a new value.
            - `lower score` / `upper score`: Applies metrics only if the resulting score is lower/higher than the previous one.
            - `lower metric` / `upper metric`: Applies metrics only if the metric is ranked lower/higher than the one already set.
        - `metrics` (required): The CVSS vector string defining the change (e.g. `MAV:N`). For `reset modification`, this can be `all` or a slash-separated list of metrics (e.g. `AV/AC`).

Flags to determine whether the assessment event should be considered at all (more information can be found in [Event Filtering](#event-filtering)):

- `active`: Whether to include the event in the assessment evaluation.
- `discard prior events`: Fully resets all previous events.
- `discard events until baseline`: Fully resets all previous events that are not an inventory-scope (baseline) assessment.
- `discard on subsequent events`: If there are later events, this event and all prior ones are discarded. If this is the latest event, it remains active.

</details>

<details>

<summary><h3>JSON</h3></summary>

The JSON formats of the vulnerability assessment schema are not intended to be written by a human being and merely serve as exchange format between processes and the API, and changes to the format may be more drastical between versions.
The JSON format mirrors the internal data structure of the Java and TypeScript implementations of the assessment systems.

The most important changes compared to the YAML format are:

- Both the assessments and assessment events contain their `schemaVersion` and `scope` as properties to allow them being parsed independently from each other.
- Every event gets assigned a UUID that should remain stable for this event.
- A `creationContext` is defined on the assessment that may store additional information on where the assessment was created in.

A full example of the structure can be found in [version 2.1](vulnerability-assessment-file-gen-4-2.1.md).

</details>

## Effective Assessment

Assessment Events on a vulnerability can be collected from many sources, such as the Vulnerability Status, Keywords or from the Dashboard API.
The calculation of what the effective assessment for a vulnerability from all of these is requires three steps to be applied on the aggregated assessment events:

- [Event Ordering](#event-ordering): Determine the order of the assessment events based on their intrinsic properties.
- [Event Filtering](#event-filtering): Select only the applicable assessment events based on various properties.
- [Effective Event Construction](#effective-event-construction): Use the remaining and ordered events to collect the properties into an effective assessment.

### Event Ordering

Since events can be collected in any order, they must be sorted before evaluation.
Events are ranked using the following criteria, applied in order:

1. Events with a higher **priority** are ranked higher.
2. Events with the **inventory** scope are ranked lower.
3. **Inactive** events are ranked lower.
4. Events with a later **date** are ranked higher.
   The date is a mandatory field, since this is usually the last meaningful ordering criteria.
5. Events containing **rationale, measures, or risk information** are ranked higher.
6. Events with a **status** are ranked higher.
7. Events with a more **severe status** are ranked higher.

This guarantees a deterministic order for processing.

### Event Filtering

The filtering process is executed in separate steps to make sure that events are discarded according to the defined logic.
The system will iterate over all assessment events for all the following rules, no matter if they have already been marked as discarded:

#### Inactive Events (`active`)

Any event marked as `active: false` is immediately marked as discarded.

#### Discard on Subsequent Events (`discardOnSubsequentEvents`)

If an event has this flag enabled (`true`), it will check all events that are ordered after (later) the current event:

- If all events in this list have the `isAutoAppendedForDisplay` flag set, this entry does nothing.
- Otherwise, if there are any entries at all after the event, the event marks itself and all earlier events as discarded.

> `isAutoAppendedForDisplay` is a system-only flag that is set on the assessment events that are appended by the system if the base effective assessment does not have a status set.
> This is usually the case if only an inventory-scope assessment has been provided.
> It's best not to think about this flag too much, as it simply ensures behind the scenes that this automatically generated assessment entry does not interfere with the manually specified ones.

#### Discard Prior Events (`discardPriorEvents`)

> [!CAUTION]
> It is heavily recommended to use `discardEventsUntilBaseline` instead.

A reset flag for the assessment events, clearing ALL events that come before (preceding) the current assessment, making the selected event the new baseline for evaluation.
This should only be used very sparingly, since:

- there is absolutely no way to undo this through only adding new events on top,
- and it will also clear baseline assessments forever on this vulnerability unless it is removed manually from the data supplying this assessment.

#### Discard Prior Events until Baseline (`discardEventsUntilBaseline`)

Similarly to the `discardPriorEvents` flag, setting `discardEventsUntilBaseline` will deactivate events prior to the current event.
However, it will not deactivate any inventory-scope (baseline) assessments, making it viable to use.

The "Restart assessment from the latest Baseline Assessment, clear all manual assessments in between" option in the dashboard is solved using this flag.

### Effective Event Construction

Once the order of the events has been established and the relevant events are determined,
they are used to construct the effective vulnerability assessment.
The filtered events are processed from the first to the latest.

Each event contributes its properties to the assessment, applying them only if they are not already set.

- The following properties are overwritten on each assignment:
    - Status
    - Rationale
    - Risk
    - Measures
    - Score
- CVSS modifications are applied incrementally, collecting metrics and rationales per version.
- Reviewed advisories from all retained events are collected into the effective assessment.

Any events that were discarded during filtering are tracked separately as `unused source events` to allow a proper history to be built.

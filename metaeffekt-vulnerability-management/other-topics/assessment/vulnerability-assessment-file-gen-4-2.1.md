> [Documentation](../../../README.md) >
> [Vulnerability Management](../../vulnerability-management.md) >
> Data Formats >
> [Vulnerability Assessment](vulnerability-assessment.md) >
> 2.1

# Vulnerability Assessment (Version 2.1, Generation 4.x)

The [Task AE-1378](https://github.com/org-metaeffekt/metaeffekt-artifact-analysis/pull/375) introduces a new Assessment Format version 2.1 that builds on the previous 2.0 version.

It provides a refactoring of the vulnerability assessment data model and its surrounding infrastructure.
The previous, rigid structure for CVSS modifications has been replaced with a flexible model is easier to extend and maintain.
To enable this change, the parsers and serializers for both JSON and YAML have been rewritten from scratch to allow better differentiation between assessment schema versions and allow version-specific parsing.
This will allow for an easier modification of the formats in the future.
Additionally, A new plugin for migrating existing assessment files to the latest version has been introduced.

## Assessment Data Model Changes

The YAML/JSON structure for defining CVSS modifications has been completely redesigned, alongside some other format changes.

### YAML

The 2.0 format with separate keys for each CVSS version (`cvssV2`, `cvssV3P1`) and modification type (`overwrite`, `lowerScore`) is now no longer usable.
Instead the the `cvss` key now contains a unified, list-based structure.
This "rationale-centric" format groups modifications under a common rationale, with each entry defining its vector `version`, modification `type` and the `metrics` to be applied.
The primary goal of this change was to create a more scalable and developer-friendly structure for handling CVSS modifications.

This is the only change regarding the YAML format, see changes to the JSON structure in the chapter below.

2.1 Format Example:

```yaml
schema-version: "2.1"

assessments:
  - scope: vulnerability
    affects:
      vulnerabilities:
        - CVE-2023-32040
    events:
      - date: 2020-01-01
        cvss:
        - rationale: "Component is only accessible from a trusted internal network."
          modifications:
            - version: "4.0"
              type: "lower metric"
              metrics: "MAV:N"
            - version: "3.1"
              type: "lower metric"
              metrics: "MAV:N"
```

<details>
<summary><strong>Click to see format comparison: v2.0 vs. v1.0</strong></summary>

#### Old v2.0 Format

```yaml
schema-version: "2.0"

assessments:
  - scope: vulnerability
    affects:
      vulnerabilities:
        - CVE-2023-32040
    events:
      - date: 2020-01-01
        cvss:
          - rationale: "Component is only accessible from a trusted internal network."
            v4.0:
              lower metric:
                - metrics: "MAV:N"
            v3.1:
              lower metric:
                - metrics: "MAV:N"
```

#### Legacy v1.0 Format

Note that this format does not specify the schema version.
This is the criteria for a 1.0 assessment in the detection logic:
If no version is found, it is interpreted as 1.0 assessment.

```yaml
- ignoreWhenVoid: false
  affects:
    cve:
      - CVE-2023-32040
  history:
    - status: applicable
      priority: -10
      rationale: "Component is only accessible from a trusted internal network."
      date: 2020-01-01

  cvssV4:
    lower: "CVSS:4.0/MAV:N"
  cvssV3:
    lower: "CVSS:3.1/MAV:N"
```
</details>

The system can still read and parse old v1.0 and v2.0 assessment files, automatically converting them to the new v2.1 structure internally.

### JSON Format

Since 2.0, assessments can be serialized to / parsed from JSON objects and arrays.
The JSON structure and logic for assessments and their events has changed significantly in 2.1.

- The dashboard frontend now operates solely on assessments wrapping assessment events, and not assessment events directly. 
  - The assessment editor will now send assessments to the backend instead of events.
  - The dashboard will convert events received from the backend into assessments by extracting the `affects` section and wrapping it with the assessment container.
- The dashboard frontend previously wrote an artificial property `createdForContext` into the assessment events that it sent to the backend.
  This property would be discarded when parsed by the java process, be it by the upgrade version plugin or otherwise.
  - A new `creationContext` property has been introduced, which contains an `assetId` and an `assessmentId`, in addition to a `custom` object in which any further properties such as paths or inventory context information can be preserved.

#### Version 2.0

```json
{
  "uid": "1166230f-dbcc-4e57-a4a6-a50fd02e0b9c",
  "date": 1758008113011,
  "scope": "VULNERABILITY",
  "affects": {
    "affectedVulnerabilities": [
      "CVE-2025-7962"
    ]
  },
  "author": "Yan Wittmann",
  "authorId": "yan",
  "rationale": "Rationale",
  "createdForVulnerability": "CVE-2025-7962",
  "createdForContext": "context-001",
  "cvssV2": {
    "lowerMetric": [
      {
        "rationale": "test",
        "metrics": "AV:L/AC:H/Au:S/C:P/I:P/A:P/CDP:MH"
      }
    ]
  },
  "active": true,
  "priority": 0,
  "discardPriorEvents": false,
  "discardOnSubsequentEvents": false,
  "discardEventsUntilBaseline": false,
  "isAutoAppendedForDisplay": false,
  "reviewedAdvisories": []
}
```

#### Version 2.1

```json
[
  {
    "schemaVersion": "2.1",
    "scope": "VULNERABILITY",
    "affects": {
      "affectedVulnerabilities": [
        "CVE-2025-7962"
      ],
      "affectedCpe": [],
      "affectedCwe": [],
      "affectedConditions": [],
      "labelsIncludes": [],
      "labelsExcludes": []
    },
    "events": [
      {
        "schemaVersion": "2.1",
        "uid": "1166230f-dbcc-4e57-a4a6-a50fd02e0b9c",
        "isAutoAppendedForDisplay": false,
        "discardOnSubsequentEvents": false,
        "discardPriorEvents": false,
        "discardEventsUntilBaseline": false,
        "active": true,
        "scope": "VULNERABILITY",
        "rationale": "Rationale",
        "author": "Yan Wittmann",
        "authorId": "yan",
        "date": 1758008113011,
        "priority": 0,
        "cvss": [
          {
            "rationale": "test",
            "modifications": [
              {
                "version": "2.0",
                "type": "lower metric",
                "metrics": "AV:L/AC:H/Au:S/C:P/I:P/A:P/CDP:MH"
              }
            ]
          }
        ],
        "reviewedAdvisories": []
      }
    ],
    "ignoreWhenVoid": false,
    "creationContext": {
      "assetId": "context-001",
      "custom": {
        "createdForVulnerability": "CVE-2025-7962"
      }
    }
  }
]
```

## Assessment Format Upgrade Tool

To enable the migration of existing assessments to the new 2.1 JSON format, this PR introduces a new Maven plugin `upgrade-assessment-files`.
This tool allows users to convert a collection of old assessment files (v1.0/v2.0 YAML or JSON) in the latest v2.1 format.

The plugin supports three operational modes, configured via the `<outputMode>` parameter:

- **`MERGE`**: Combines all assessments from all input files into a single, unified JSON file.
- **`DIRECTORY`**: Recreates the input directory structure within a specified output directory, converting each source file individually.
- **`IN_PLACE`**: Modifies the assessment files directly, replacing each original file with its upgraded `.json` equivalent.

```xml
<plugin>
    <groupId>com.metaeffekt.artifact.analysis</groupId>
    <artifactId>ae-inventory-enrichment-plugin</artifactId>
    <version>${ae.artifact-analysis.version}</version>
    <executions>
        <execution>
            <goals>
                <goal>upgrade-assessment-files</goal>
            </goals>
            <configuration>
                <!-- see below for individual modes -->
            </configuration>
        </execution>
    </executions>
</plugin>
```

### Mode 1: Merge into a Single File

This configuration reads from multiple sources and writes all converted assessments into a single target file.

```xml
<configuration>
    <inputFiles>
        <file>path/to/old/assessments-dir1</file>
        <file>path/to/old-assessment-2.json</file>
    </inputFiles>
    <outputMode>MERGE</outputMode>
    <outputFile>target/upgraded-assessments.json</outputFile>
</configuration>
```

### Mode 2: Recreate Directory Structure

This mode is useful for converting a batch of files while preserving their original organization.
The structure of the input directories is replicated in the output directory.

```xml
<configuration>
    <inputFiles>
        <file>src/main/assessments/project-a</file>
        <file>src/main/assessments/project-b</file>
    </inputFiles>
    <outputMode>DIRECTORY</outputMode>
    <!-- The output will be in target/upgraded-assessments/... -->
    <outputFile>target/upgraded-assessments</outputFile>
</configuration>
```

### Mode 3: Update Files In-Place

This mode directly modifies your source tree by replacing each source file (e.g. `assessment.yaml`) with its upgraded version (`assessment.json`).
This means that the original file is either replaced or deleted after successful conversion.
Back up your assessments before performing this operation, or use `DIRECTORY` mode first to validate the results.

```xml
<configuration>
    <inputFiles>
        <file>src/main/assessments/</file>
    </inputFiles>
    <outputMode>IN_PLACE</outputMode>
    <!-- The outputFile parameter is ignored in this mode -->
</configuration>
```

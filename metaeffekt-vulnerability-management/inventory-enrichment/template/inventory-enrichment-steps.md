> [Documentation](../../README.md) >
> [Vulnerability Management](../vulnerability-management.md) >
> [Inventory Enrichment Pipeline](inventory-enrichment-pipeline.md) >
> Inventory Enrichment Steps

# Inventory Enrichment Steps

> [Overview](#overview) -
> [POM Configuration](#pom-configuration) -
> [Steps](#product-identification)

## Overview

The inventory enrichment pipeline has already been described with a quick overview in the
[Inventory Enrichment Pipeline](inventory-enrichment-pipeline.md) chapter.
This chapter provides a detailed description of each step in the inventory enrichment pipeline.
While it is theoretically possible to construct a pipeline that runs the following steps in any order,
on a conceptual level, only a specific order makes sense.
This is why the steps are divided into separate phases, which are executed in a specific order, but within each phase,
the steps can be executed in any order.

In some cases, such as with the Vulnerability Details Fill phase,
a phase might have to run twice if certain conditions are met.
In order to reduce the length of the following list, these duplications have been omitted.
The descriptions when a phase has to run twice are included in the respective phase's description,
but the responsible maven plugin manages this automatically, so that you, as a user, will not have to worry about this.

$gen{enrichment-steps-active}


## POM Configuration

The enrichment configuration is part of the `ae-inventory-enrichment-plugin` configuration in the Maven POM.
An example configuration with all available enrichment steps is provided below.

<details>

<summary>Click to show the full POM configuration with all configuration parameters</summary>

```xml
<plugins>
    <plugin>
        <groupId>com.metaeffekt.artifact.analysis</groupId>
        <artifactId>ae-inventory-enrichment-plugin</artifactId>
        <version>${ae.artifact.analysis.version}</version>

        <executions>
            <execution>
                <id>enrich-inventory</id>
                <goals>
                    <goal>enrich-inventory</goal>
                </goals>

                <configuration>
                    <!-- General Configuration -->
                    <mirrorDirectory>${database.path}</mirrorDirectory>

                    <inventoryInputFile>${inventory.path}</inventoryInputFile>
                    <inventoryOutputFile>${inventory.path}-result.xlsx</inventoryOutputFile>
                    <intermediateInventoriesDirectory>${inventory.path}/intermediate-inventories</intermediateInventoriesDirectory>

                    <writeIntermediateInventories>true</writeIntermediateInventories>
                    <storeIntermediateStepsInInventoryInfo>true</storeIntermediateStepsInInventoryInfo>

                    <!-- resume the pipeline at a specific step by its id -->
                    <!--<resumeAtEnrichment></resumeAtEnrichment>-->

                    <!-- Security Policy Configuration -->
                    <!--<securityPolicy></securityPolicy>-->
                    <!--<securityPolicyFile></securityPolicyFile>-->
                    <!--<securityPolicyOverwriteJson></securityPolicyOverwriteJson>-->


$gen{index-pom-complete-configuration}
                </configuration>
            </execution>
        </executions>
    </plugin>
</plugins>
```

</details>

<details>

<summary>Click to show the shortened POM configuration</summary>

```xml
<plugins>
    <plugin>
        <groupId>com.metaeffekt.artifact.analysis</groupId>
        <artifactId>ae-inventory-enrichment-plugin</artifactId>
        <version>${ae.artifact.analysis.version}</version>

        <executions>
            <execution>
                <id>enrich-inventory</id>
                <goals>
                    <goal>enrich-inventory</goal>
                </goals>

                <configuration>
                    <!-- General Configuration -->
                    <mirrorDirectory>${database.path}</mirrorDirectory>

                    <inventoryInputFile>${inventory.path}</inventoryInputFile>
                    <inventoryOutputFile>${inventory.path}-result.xlsx</inventoryOutputFile>
                    <intermediateInventoriesDirectory>${inventory.path}/intermediate-inventories</intermediateInventoriesDirectory>

                    <writeIntermediateInventories>true</writeIntermediateInventories>
                    <storeIntermediateStepsInInventoryInfo>true</storeIntermediateStepsInInventoryInfo>

                    <!-- resume the pipeline at a specific step by its id -->
                    <!--<resumeAtEnrichment></resumeAtEnrichment>-->

                    <!-- Security Policy Configuration -->
                    <!--<securityPolicy></securityPolicy>-->
                    <!--<securityPolicyFile></securityPolicyFile>-->
                    <!--<securityPolicyOverwriteJson></securityPolicyOverwriteJson>-->


$gen{index-pom-short-configuration}
                </configuration>
            </execution>
        </executions>
    </plugin>
</plugins>
```

</details>

<details>

<summary>Click to show the full default security policy configuration</summary>

See
[the data class](https://github.com/org-metaeffekt/metaeffekt-core/blob/master/libraries/ae-inventory-processor/src/main/java/org/metaeffekt/core/inventory/processor/report/configuration/CentralSecurityPolicyConfiguration.java)
for more details on the individual parameters.

```json
$gen{index-pom-default-security-policy}
```

</details>

---

# Product Identification

A challenge for the vulnerability matching is that every vulnerability and security advisory provider uses different
formats and methods of identifying products and versions in their knowledge database.
A couple of examples for actual product identification methods are:

- The [National Vulnerability Database (NVD)](https://nvd.nist.gov/vuln)
  uses the [Common Platform Enumeration (CPE)](https://cpe.mitre.org/specification) to identify products,
- [Microsoft Security Response Center (MSRC)](https://www.microsoft.com/en-us/msrc)
  uses a numeric registry with a number for each product and version,
- [GitHub Security Advisories (GHSA)](https://github.com/advisories)
  and others use [Package URLs (PURLs)](https://github.com/package-url/purl-spec),
- [End Of Life](https://endoflife.date) uses unique string identifiers for each product,
- and so on.

This diversity of product identifiers is not represented in the initial software component inventory.
Therefore, the first step in the vulnerability matching process is to attempt to automatically derive product
identifiers from the component metadata, including artifact names, versions, and vendor information.

The following two steps are always performed to enable and improve the matching accuracy:

$gen{enrichment-steps-full-doc-PRODUCT_IDENTIFICATION}

---

# Vulnerability Matching

The next phase represents the main part of the inventory enrichment process, responsible for the actual matching process
of finding vulnerabilities from various sources to the products identified in the earlier steps.

It is important to note that _only the vulnerabilities themselves_ are identified during this phase, excluding any
vulnerability metadata such as descriptions or CVSS vectors.
This distinction between finding identifiers and adding details is made to allow for adding those details after any
amount of vulnerability identification steps exactly once,
instead of performing them after each one individually.

Each of the steps below uses a different method to identify vulnerabilities, since each source uses different formats
and methods to identify vulnerabilities.
But all of them have in common that they identify vulnerabilities based on the products present in the inventory.

$gen{enrichment-steps-full-doc-VULNERABILITY_MATCHING}

---

# Vulnerability Details Filling

As mentioned in the [Vulnerability Matching](#vulnerability-matching) section, only the vulnerabilities themselves are
identified during the matching process.
This phase is responsible for adding the details to the vulnerabilities identified in the previous phase.
This includes details like descriptions, CVSS vectors, references, and more.

The steps in this phase might have to be run multiple times in your pipeline, depending on whether you use the
assessments steps or similar steps that require the details to be present, but may add new vulnerabilities to the
inventory that then again require details to be filled.

$gen{enrichment-steps-full-doc-VULNERABILITY_DETAILS_FILLING}

---

# Assessments

To allow teams of assessors to evaluate the identified vulnerabilities and security advisories,
this phase allows for injecting assessments for vulnerabilities and security advisories into the inventory.
For this, the [Assessment File format](https://metaeffekt.com/schema/artifact-analysis) is used, see the link for
more details on how to create such files.
These assessments will show up in the generated reports and dashboards.

Since this step both requires vulnerability details to be present and may add new vulnerabilities to the inventory
(void vulnerabilities), the [Vulnerability Details Filling](#vulnerability-details-filling) phase has to be run before
and after this phase.

$gen{enrichment-steps-full-doc-ASSESSMENTS}

---

# Security Advisory Matching

Once all vulnerabilities are known and have their details filled, the next phase is to match security advisories to the
vulnerabilities to support the assessment and remediation process.
For this, (as usual) each step uses a different method to identify relevant security advisories based on the
vulnerabilities and products present in the inventory.

$gen{enrichment-steps-full-doc-SECURITY_ADVISORY_MATCHING}

---

# Vulnerability Prioritization

The final phase that adds new data to the inventory is the vulnerability prioritization information.
It adds information that allows for the prioritization of vulnerabilities based on their current exploit state,
severity, and other factors by calculating a combined priority score for each vulnerability.
This score is displayed in the generated reports and dashboards.

$gen{enrichment-steps-full-doc-VULNERABILITY_PRIORITIZATION}

---

# Post Processing

A simple step that runs several check-ups and post-processing steps on the inventory to ensure that the inventory is
consistent and ready for the reporting phase.

$gen{enrichment-steps-full-doc-INVENTORY_POST_PROCESSING}

---

# Reporting

The final phase of the inventory enrichment pipeline is the reporting phase, which generates the Vulnerability
Assessment Dashboard.
This dashboard is a web-based HTML report that provides an overview of the vulnerabilities and security advisories
identified in an inventory.

An example of the dashboard for
[OpenSSL 3.0.6 can be found here](https://metaeffekt.com/security/dashboards/openssl-3.0.6-dashboard.html?sort=7&sortDir=false).

$gen{enrichment-steps-full-doc-REPORTING}

---

# Other standalone steps

$gen{enrichment-steps-full-doc-STANDALONE}

---

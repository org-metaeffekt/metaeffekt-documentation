> [Documentation](../../../README.md) >
> [Vulnerability Management](../../vulnerability-management.md) >
> [Vulnerability Data Mirror](../vulnerability-data-mirror.md) >
> [OSV](osv.md) >
> AE-1477

# AE-1477: OSV PURL-Based Vulnerability Matching Refactor / Fixed Versions tracking

This pull request introduces a significant refactoring of the OSV vulnerability enrichment process.
It replaces the old workflow that only partially considered the PURL information on the security advisories with one that is able to compare PURLs on both the artifact and OSV side.
This change majorly simplifies configuration and improves matching accuracy if known PURLs are entered or can be calculated automatically.
Additionally, this PR introduces the capability to track and display fixed software versions from OSV advisories.

## Inventory / Pipeline changes

To give an overview of possible action items, this chapter provides a list of changes that are most relevant to a user of the software.
More details on every point can be found in the chapters below this one.

### Enrichment Pipeline

- Added `purlDerivationEnrichment`, which is responsible for deriving PURLs for artifacts in the inventory.
- Added `inventoryPostProcessingEnrichment`, which currently provides a single post-processing action on the inventory but might be extended in the future.
    - `filterVulnerableSoftwareConfigurationsIrrelevantToInventory = true` will filter out all `Version Ranges` that are not applicable on the current inventory by checking the PURLs on the artifacts.
- Modified `osvVulnerabilitiesEnrichment` to no longer require all the individual ecosystem configuration parameters like `maven` or `hex` and instead determining these using the input PURLs per artifact.
- Removed GHSA enrichment steps in favor of using the OSV enrichment steps.
  This should not cause any issues, since they were not capable of being activated anyway by the user.

### Inventory

- Added `Version Ranges` column on Vulnerabilities and Security Advisories, in which they can store arbitrary vulnerable software configurations.
  Currently used for storing the fixed versions:

  ```json
  [
    {
      "provider": {
        "implementation": "OSV",
        "name": "GHSA",
        "id": "GHSA-v435-xc8x-wvr9"
      },
      "ecosystem": "Maven",
      "name": "org.bouncycastle:bcprov-jdk18on",
      "purl": "pkg:maven/org.bouncycastle/bcprov-jdk18on",
      "fixedVersions": [
        {
          "vulnerable": false,
          "version": "1.78"
        }
      ]
    }
  ]
  ```

- Added `Derived PURLs` column on Artifacts that will have its contents filled from the `purlDerivationEnrichment` in case the `PURL` column is not already set.
  The value is a comma separated list of PURLs that each might match the current artifact based on the limited information provided.
- Added `Inapplicable PURLs` column on Artifacts.
  It is a CSV List of (partially or fully defined) PURLs that the artifact is not represented by.
  Use `*` for any value on all fields except for the `type`, which does not allow the asterisk character, use `any` for the `type` instead.

package com.metaeffekt.documentation;

import lombok.extern.slf4j.Slf4j;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Supplier;

@Slf4j
public class TemplateRegistry {

    private final Map<String, Supplier<String>> registry = new HashMap<>();

    public void register(String key, Supplier<String> supplier) {
        if (registry.containsKey(key)) {
            throw new IllegalStateException("Duplicate template key detected: [" + key + "]. Variables must be globally unique.");
        }
        registry.put(key, supplier);
    }

    public void registerAll(Map<String, Supplier<String>> variables) {
        variables.forEach(this::register);
    }

    public String getValue(String key) {
        Supplier<String> supplier = registry.get(key);
        if (supplier == null) {
            // Depending on strictness, we might return null, throw exception, or return a placeholder.
            // For now, fail fast to ensure templates are correct.
            // throw new IllegalArgumentException("Unknown template variable: [" + key + "]");
            log.error("Unknown template variable: [{}]", key);
            return "Unknown template variable: [" + key + "]";
        }
        try {
            return supplier.get();
        } catch (Exception e) {
            throw new RuntimeException("Error computing value for key [" + key + "]", e);
        }
    }
}
